<?xml version='1.0' encoding='ISO-8859-15' ?>
<!-- 

;;; $Id$
(comment "benchmark objet")
(expected-result 8999)
(expected-printing 1000)

(defclass Point Object
  (x)
  (define (setX x)
    (oset! (self) "x" x)
    (self) )
  (define (moveX dx)
    (oset! (self) "x" (+ (oget (self) "x") dx))
    (self) ) )

(defclass Point2D Point
  (y)
  (define (moveX dx)
    (oset! (self) "x" (+ (oget (self) "x") dx))
    (self) )
  (define (moveXY dx dy)
    (oset! (self) "y" (+ (oget (self) "y") dy))
    (self) )
  (define (print)
    (print "print@Point2D")
    (super) ) )

(defclass Point3D Point2D
  (z)
  (define (moveX dx)
    (oset! (self) "x" (+ (oget (self) "x") dx))
    (self) )
  (define (moveXY dx dy)
    (send "moveX" self dx)
    (oset! (self) "y" (+ (oget (self) "y") dy))
    (self) )
  (define (print)
    (print "print@Point3D")
    (super) ) )

(defclass Point2Dcolored Point2D
  (color)
  (define (moveXY dx dy)
    (send "moveX" self dx)
    (oset! (self) "y" (+ (oget (self) "y") dy))
    (self) )
  (define (print)
    (print "print@Point2Dcolored")
    (super) ) )

(defclass Point3Dcolored Point2Dcolored
  (zz)
  (define (moveXY dx dy)
    (oset! (self) "y" (+ (oget (self) "y") dy))
    (self) )
  (define (print)
    (print "print@Point3Dcolored")
    (super) ) )

(define (rand max)
  ;; N'importe quoi!
  (set! seed (modulo (* 16807 seed) 2147483647))
  (modulo seed max) )

;;; 1000 invocations
(let ((k 1000)
      (pt 0) )
  (set! seed 11)
  (print k)
  (while (> k 0)
     (set! k (- k 1))
     (let ((random (rand 4)))
       ;; allouer un point quelconque
       (if (= random 0)
           (set! pt (new Point2D 1 2))
           (if (= random 1)
               (set! pt (new Point3D 1 2 3))
               (if (= random 2)
                   (set! pt (new Point2Dcolored 1 2 "blue"))
                   (set! pt (new Point3Dcolored 1 2 3 "red")) ) ) ) )
     (let ((random (rand 3)))
       ;; invoquer une methode quelconque
       (if (= random 0)
           (send "moveX" pt 11)
           (if (= random 1)
           		(send "moveXY" pt 22 33)
           		(send "setX" pt 44) ) ) ) )
  8999 )

;;; end of u8999-6.scm

 -->
<programme6
><!-- test:name description='benchmark objet' 
--><!-- test:result value='8999' 
--><!-- test:printing value='...a faire...' 
--><definitionClasse nom='Point' parent='Object'
><champs
><champ nom='x'
/></champs
><methodes
><methode nom='setX'
><variables
><variable nom='x'
/></variables
><corps
><ecritureChamp champ='x'
><cible
><moi
/></cible
><valeur
><variable nom='x'
/></valeur
></ecritureChamp
><moi
/></corps
></methode
><methode nom='moveX'
><variables
><variable nom='dx'
/></variables
><corps
><ecritureChamp champ='x'
><cible
><moi
/></cible
><valeur
><operationBinaire operateur='+'
><operandeGauche
><lectureChamp champ='x'
><cible
><moi
/></cible
></lectureChamp
></operandeGauche
><operandeDroit
><variable nom='dx'
/></operandeDroit
></operationBinaire
></valeur
></ecritureChamp
><moi
/></corps
></methode
></methodes
></definitionClasse
><definitionClasse nom='Point2D' parent='Point'
><champs
><champ nom='y'
/></champs
><methodes
><methode nom='moveXY'
><variables
><variable nom='dx'
/><variable nom='dy'
/></variables
><corps
><ecritureChamp champ='y'
><cible
><moi
/></cible
><valeur
><operationBinaire operateur='+'
><operandeGauche
><lectureChamp champ='y'
><cible
><moi
/></cible
></lectureChamp
></operandeGauche
><operandeDroit
><variable nom='dy'
/></operandeDroit
></operationBinaire
></valeur
></ecritureChamp
><moi
/></corps
></methode
><methode nom='print'
><variables
></variables
><corps
><invocationPrimitive fonction='print'
><chaine
>print@Point2D</chaine
></invocationPrimitive
><appelSuper
/></corps
></methode
></methodes
></definitionClasse
><definitionClasse nom='Point3D' parent='Point2D'
><champs
><champ nom='z'
/></champs
><methodes
><methode nom='moveXY'
><variables
><variable nom='dx'
/><variable nom='dy'
/></variables
><corps
><envoiMessage message='moveX'
><receveur
><moi
/></receveur
><arguments
><variable nom='dx'
/></arguments
></envoiMessage
><ecritureChamp champ='y'
><cible
><moi
/></cible
><valeur
><operationBinaire operateur='+'
><operandeGauche
><lectureChamp champ='y'
><cible
><moi
/></cible
></lectureChamp
></operandeGauche
><operandeDroit
><variable nom='dy'
/></operandeDroit
></operationBinaire
></valeur
></ecritureChamp
><moi
/></corps
></methode
><methode nom='print'
><variables
></variables
><corps
><invocationPrimitive fonction='print'
><chaine
>print@Point3D</chaine
></invocationPrimitive
><appelSuper
/></corps
></methode
></methodes
></definitionClasse
><definitionClasse nom='Point2Dcolored' parent='Point2D'
><champs
><champ nom='color'
/></champs
><methodes
><methode nom='moveXY'
><variables
><variable nom='dx'
/><variable nom='dy'
/></variables
><corps
><envoiMessage message='moveX'
><receveur
><moi
/></receveur
><arguments
><variable nom='dx'
/></arguments
></envoiMessage
><ecritureChamp champ='y'
><cible
><moi
/></cible
><valeur
><operationBinaire operateur='+'
><operandeGauche
><lectureChamp champ='y'
><cible
><moi
/></cible
></lectureChamp
></operandeGauche
><operandeDroit
><variable nom='dy'
/></operandeDroit
></operationBinaire
></valeur
></ecritureChamp
><moi
/></corps
></methode
><methode nom='print'
><variables
></variables
><corps
><invocationPrimitive fonction='print'
><chaine
>print@Point2Dcolored</chaine
></invocationPrimitive
><appelSuper
/></corps
></methode
></methodes
></definitionClasse
><definitionClasse nom='Point3Dcolored' parent='Point2Dcolored'
><champs
><champ nom='zz'
/></champs
><methodes
><methode nom='moveXY'
><variables
><variable nom='dx'
/><variable nom='dy'
/></variables
><corps
><ecritureChamp champ='y'
><cible
><moi
/></cible
><valeur
><operationBinaire operateur='+'
><operandeGauche
><lectureChamp champ='y'
><cible
><moi
/></cible
></lectureChamp
></operandeGauche
><operandeDroit
><variable nom='dy'
/></operandeDroit
></operationBinaire
></valeur
></ecritureChamp
><moi
/></corps
></methode
><methode nom='print'
><variables
></variables
><corps
><invocationPrimitive fonction='print'
><chaine
>print@Point3Dcolored</chaine
></invocationPrimitive
><appelSuper
/></corps
></methode
></methodes
></definitionClasse
><definitionFonction nom='rand'
><variables
><variable nom='max'
/></variables
><corps
><affectation nom='seed'
><valeur
><operationBinaire operateur='%'
><operandeGauche
><operationBinaire operateur='*'
><operandeGauche
><entier valeur='16807'
/></operandeGauche
><operandeDroit
><variable nom='seed'
/></operandeDroit
></operationBinaire
></operandeGauche
><operandeDroit
><entier valeur='2147483647'
/></operandeDroit
></operationBinaire
></valeur
></affectation
><operationBinaire operateur='%'
><operandeGauche
><variable nom='seed'
/></operandeGauche
><operandeDroit
><variable nom='max'
/></operandeDroit
></operationBinaire
></corps
></definitionFonction
><blocLocal
><liaisons
><liaison
><variable nom='k'
/><initialisation
><entier valeur='1000'
/></initialisation
></liaison
><liaison
><variable nom='pt'
/><initialisation
><entier valeur='0'
/></initialisation
></liaison
></liaisons
><corps
><affectation nom='seed'
><valeur
><entier valeur='11'
/></valeur
></affectation
><invocationPrimitive fonction='print'
><variable nom='k'
/></invocationPrimitive
><boucle
><condition
><operationBinaire operateur='&gt;'
><operandeGauche
><variable nom='k'
/></operandeGauche
><operandeDroit
><entier valeur='0'
/></operandeDroit
></operationBinaire
></condition
><corps
><affectation nom='k'
><valeur
><operationBinaire operateur='-'
><operandeGauche
><variable nom='k'
/></operandeGauche
><operandeDroit
><entier valeur='1'
/></operandeDroit
></operationBinaire
></valeur
></affectation
><blocUnaire
><variable nom='random'
/><valeur
><invocation
><fonction
><variable nom='rand'
/></fonction
><arguments
><entier valeur='4'
/></arguments
></invocation
></valeur
><corps
><alternative
><condition
><operationBinaire operateur='=='
><operandeGauche
><variable nom='random'
/></operandeGauche
><operandeDroit
><entier valeur='0'
/></operandeDroit
></operationBinaire
></condition
><consequence
><affectation nom='pt'
><valeur
><creationObjet classe='Point2D'
><entier valeur='1'
/><entier valeur='2'
/></creationObjet
></valeur
></affectation
></consequence
><alternant
><alternative
><condition
><operationBinaire operateur='=='
><operandeGauche
><variable nom='random'
/></operandeGauche
><operandeDroit
><entier valeur='1'
/></operandeDroit
></operationBinaire
></condition
><consequence
><affectation nom='pt'
><valeur
><creationObjet classe='Point3D'
><entier valeur='1'
/><entier valeur='2'
/><entier valeur='3'
/></creationObjet
></valeur
></affectation
></consequence
><alternant
><alternative
><condition
><operationBinaire operateur='=='
><operandeGauche
><variable nom='random'
/></operandeGauche
><operandeDroit
><entier valeur='2'
/></operandeDroit
></operationBinaire
></condition
><consequence
><affectation nom='pt'
><valeur
><creationObjet classe='Point2Dcolored'
><entier valeur='1'
/><entier valeur='2'
/><chaine
>blue</chaine
></creationObjet
></valeur
></affectation
></consequence
><alternant
><affectation nom='pt'
><valeur
><creationObjet classe='Point3Dcolored'
><entier valeur='1'
/><entier valeur='2'
/><entier valeur='3'
/><chaine
>red</chaine
></creationObjet
></valeur
></affectation
></alternant
></alternative
></alternant
></alternative
></alternant
></alternative
></corps
></blocUnaire
><blocUnaire
><variable nom='random'
/><valeur
><invocation
><fonction
><variable nom='rand'
/></fonction
><arguments
><entier valeur='3'
/></arguments
></invocation
></valeur
><corps
><alternative
><condition
><operationBinaire operateur='=='
><operandeGauche
><variable nom='random'
/></operandeGauche
><operandeDroit
><entier valeur='0'
/></operandeDroit
></operationBinaire
></condition
><consequence
><envoiMessage message='moveX'
><receveur
><variable nom='pt'
/></receveur
><arguments
><entier valeur='11'
/></arguments
></envoiMessage
></consequence
><alternant
><alternative
><condition
><operationBinaire operateur='=='
><operandeGauche
><variable nom='random'
/></operandeGauche
><operandeDroit
><entier valeur='1'
/></operandeDroit
></operationBinaire
></condition
><consequence
><envoiMessage message='moveXY'
><receveur
><variable nom='pt'
/></receveur
><arguments
><entier valeur='22'
/><entier valeur='33'
/></arguments
></envoiMessage
></consequence
><alternant
><envoiMessage message='setX'
><receveur
><variable nom='pt'
/></receveur
><arguments
><entier valeur='44'
/></arguments
></envoiMessage
></alternant
></alternative
></alternant
></alternative
></corps
></blocUnaire
></corps
></boucle
><entier valeur='8999'
/></corps
></blocLocal
></programme6
>
